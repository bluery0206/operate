{% extends 'app/base_headered.html' %}
{% load custom_filters %}

{% block content %}

	<div class="profiles">
		<div class="left">
			<div class="header">
				<h2>Personnel Profiles</h2>

				<div class="actions">
					<a class="btn" href="{% url 'profile-add' 'personnel' %}?prev=request.get_full_path|urlencode" title="Add new profile">
						<i class="fa-solid fa-plus"></i>
						<span>Add new profile</span>
					</a>
				
					{% if personnels %}
						{% if filters.state == "archived" %}
							<a class="btn" href="{% url 'archive-remove-all' 'personnel' %}" title="Unarchive all profiles">
								<span class="material-symbols-rounded">unarchive</span>
								<span>Unarchive all</span>
							</a>
						{% elif filters.state == "open" %}
							<a class="btn" href="{% url 'archive-add-all' 'personnel' %}" title="Add all profiles to archive">
								<span class="material-symbols-rounded">archive</span>
								<span>Archive all</span>
							</a>
						{% endif %}
		
						<a class="btn btn-danger" href="{% url 'profile-delete-all' 'personnel' %}?prev={{ request.path }}" title="Delete all profiles">
							<i class="fa-solid fa-trash"></i>
							<span>Delete all</span>
						</a>
					{% endif %}
				</div>
			</div>
			
			{% if is_paginated %}
				<div class="pagination left">
					<span class="page-list">
						{% if personnels.has_previous %}
							<a class="btn btn-outline-primary" href="?page=1">&laquo; First</a>
							<a class="btn btn-outline-primary" href="?page={{ personnels.previous_page_number }}">Previous</a>
						{% else %}
							<button class="btn btn-outline-secondary" disabled>&laquo; First</button>
							<button class="btn btn-outline-secondary" disabled>Previous</button>
						{% endif %}
	
						{% for num in personnels.paginator.page_range %}
							{% if personnels.number == num %}
								<a class="btn btn-primary" href="?page={{ num }}">{{ num }}</a>
							{% elif num > personnels.number|add:"-3" and num < personnels.number|add:"3" %}
								<a class="btn btn-outline-primary" href="?page={{ num }}">{{ num }}</a>
							{% endif %}
						{% endfor %}
	
						{% if personnels.has_next %}
							<a class="btn btn-outline-primary" href="?page={{ personnels.next_page_number }}">Next</a>
							<a class="btn btn-outline-primary" href="?page={{ personnels.paginator.num_pages }}">Last &raquo;</a>
						{% else %}
							<button class="btn btn-outline-secondary" disabled>Next</button>
							<button class="btn btn-outline-secondary" disabled>Last &raquo;</button>
						{% endif %}
					</span>
				</div>
			{% endif %}
	
			<!-- request.get_full_path|urlencode -->
	
			<div class="card-list">
				{% if personnels %}
					{% for profile in personnels %}
						<a class="card personnel" href="{% url 'profile' profile.p_type profile.pk %}?prev={{ request.path }}"> 
							<div class="picture">
								<img src="{{ profile.thumbnail.url }}" alt="{{ profile|full_name }}'s profile picture">
							</div>

							<div class="details">
								<span class="name detail">
									{{ profile.rank|upper }} {{ profile|full_name }}
								</span>
								<span class="detail" title="{{ profile|full_name }}'s home address">
									<i class="fa-solid fa-location-dot"></i>
									Address: {{ profile.address|title }}
								</span>
								<span class="detail" title="{{ profile|full_name }}'s profiled date">
									<!-- <i class="fa-solid fa-square-person-confined"></i> -->
									<i class="fa-solid fa-clock"></i>
									Profiled: {{ profile.date_profiled|date:"M j, Y" }}
								</span>
								<span class="detail" title="{{ profile|full_name }}'s assigned date">
									<i class="fa-solid fa-clipboard-check"></i>
									Assigned: {{ profile.date_assigned|date:"M j, Y" }}
								</span>
								<span class="detail" title="{{ profile|full_name }}'s designation">
									<i class="fa-solid fa-id-card"></i>
									Designation: {{ profile.designation }}
								</span>
							</div>
						</a>
					{% endfor %}
				{% else %}
					<h2>There are no personnel profiled.</h2>
				{% endif %}
			</div>
	
	
	
			<!-- Pagination -->
			{% if is_paginated %}
				<div class="pagination right">
					<span class="page-list">
						{% if personnels.has_previous %}
							<a class="btn btn-outline-primary" href="?page=1">&laquo; First</a>
							<a class="btn btn-outline-primary" href="?page={{ personnels.previous_page_number }}">Previous</a>
						{% else %}
							<button class="btn btn-outline-secondary" disabled>&laquo; First</button>
							<button class="btn btn-outline-secondary" disabled>Previous</button>
						{% endif %}
	
						{% for num in personnels.paginator.page_range %}
							{% if personnels.number == num %}
								<a class="btn btn-primary" href="?page={{ num }}">{{ num }}</a>
							{% elif num > personnels.number|add:"-3" and num < personnels.number|add:"3" %}
								<a class="btn btn-outline-primary" href="?page={{ num }}">{{ num }}</a>
							{% endif %}
						{% endfor %}
	
						{% if personnels.has_next %}
							<a class="btn btn-outline-primary" href="?page={{ personnels.next_page_number }}">Next</a>
							<a class="btn btn-outline-primary" href="?page={{ personnels.paginator.num_pages }}">Last &raquo;</a>
						{% else %}
							<button class="btn btn-outline-secondary" disabled>Next</button>
							<button class="btn btn-outline-secondary" disabled>Last &raquo;</button>
						{% endif %}
					</span>
				</div>
			{% endif %}
		</div>
		
		<div class="right">
			<div class="filter-bar">
				<form method="GET" class="search-form">
					<!-- Keeps filter options because initiating a new search will reset the whole page -->
					<input type="hidden" name="designation" value="{{ filters.designation }}">
					<input type="hidden" name="rank" 		value="{{ filters.rank }}">
					<input type="hidden" name="sort_order" 	value="{{ filters.sort_order }}">
					<input type="hidden" name="sort_by" 	value="{{ filters.sort_by }}">
					<input type="hidden" name="sort_order" 	value="{{ filters.sort_order }}">
					<input type="hidden" name="state" 		value="{{ filters.state }}">
	
					<h4>Search</h4>
		
					<input class="form-control" type="search" name="search" placeholder="Search by name" value="{% if filters.search %}{{ filters.search }}{% endif %}" title="Search">
					
					<div class="actions">
						<button class="btn btn-secondary" type="submit" title="Search">
							<i class="fa-solid fa-magnifying-glass"></i>
							<span>Search</span>
						</button>
						<button class="btn" type="submit" name="reset_search" title="Reset search" value="reset_search">
							<i class="fa-solid fa-rotate-left"></i>
							<span>Reset Search</span>
						</button>
					</div>
				</form>
		
		
				<!-- Filter -->
				<form method="GET" class="filter-form">
					<h4>Filter</h4>
					
					<!-- Keeps the search value in here to preserve it when resetting filters -->
					<input type="hidden" name="search" value="{{ filters.search }}">
					
					<div class="form-field">
						<label for="state">State</label>
						<select class="form-control" name="state" id="state" title="Filter by state">
							<option class="option_title"  value="">All</option>
							<option value="open" {% if filters.state == "open" %}selected{% endif %}>Open</option>
							<option value="archived" {% if filters.state == "archived" %}selected{% endif %}>Archived</option>
						</select>
					</div>
		
					<div class="form-field">
						<label for="designation">Designation</label>
						<input class="form-control" type="search" name="designation" id="designation" placeholder="Designation" value="{{ filters.designation }}">
					</div>
					
					<div class="form-field">
						<label for="rank">Rank</label>
						<select class="form-control" name="rank" id="rank" title="Filter by rank">
							<option class="option_title" value="">Ranks</option>
							
							{% for rank in ranks%}
								<option value="{{ rank }}" {% if filters.rank == rank %}selected{% endif %}>{{ rank }}</option>
							{% endfor %}
						</select>
					</div>
					
					<div class="form-field">
						<label for="sort_by">Sort by</label>
						<select class="form-control" name="sort_by" id="sort_by" title="Sort by">
							{% for pair in sort_choices %}
								<option class="option_title" value="{{ pair.0 }}" {% if pair.0 in filters.sort_by %}selected{% endif %}>{{ pair.1 }}</option>
							{% endfor %}
						</select>
					</div>
					
					<div class="form-field">
						<label for="sort_order">Order</label>
						<select class="form-control" name="sort_order" id="sort_order" title="Sort order">
							{% for pair in order_choices %}
								<option class="option_title" value="{{ pair.0 }}" {% if pair.0 in filters.sort_order %}selected{% endif %}>{{ pair.1 }}</option>
							{% endfor %}
						</select>
					</div>
		
					<div class="actions">
						<button class="btn btn-secondary" type="submit" title="Apply filter">
							<i class="fa-solid fa-filter"></i>
							<span>Apply Filter</span>
						</button>
			
						<button class="btn" type="submit" name="reset_filter"  title="Reset filter" value="reset_filter">
								<i class="fa-solid fa-filter-circle-xmark"></i>
								<span>Reset Filter</span>
						</button>
					</div>
				</form>
			</div>

		
	</div>
	
{% endblock content %}